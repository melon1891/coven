# TsT (Coven)

トリックテイキングとワーカープレイスメントを組み合わせたカードゲームプロトタイプ。

## 必要環境

- Python 3.11+
- [uv](https://docs.astral.sh/uv/) (推奨)

## セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/melon1891/coven.git
cd coven

# 依存関係をインストール (uv使用)
uv sync
```

## 起動方法

### CLIモード（対人プレイ）

```bash
# uv使用（推奨）
uv run python main.py

# または直接Python
python main.py
```

### 自動実行モード（Botのみ）

CI検証や動作確認用に4人全員Botで自動的にゲームが進みます。

```bash
# ランダムシード（毎回異なる結果）
uv run python main.py --auto

# 固定シード（再現可能）
uv run python main.py --auto --seed 12345
```

### Streamlit GUIモード

```bash
uv run streamlit run streamlit_app.py
```

## シミュレーション

ゲームバランス検証用の各種シミュレーションが可能です。

```bash
# カードランク別の勝率分析
uv run python main.py --simulate

# デッキ枚数別の分析
uv run python main.py --simulate-deck

# 負債ペナルティの分析
uv run python main.py --simulate-debt-penalty

# 恩寵ポイント閾値の分析
uv run python main.py --simulate-grace
```

## ゲームルール

### 基本情報

- **プレイ人数**: 4人（1人 + Bot 3人、または全員Bot）
- **ラウンド数**: 6ラウンド
- **勝利条件**: 最終ラウンド終了時に最も多くのVPを獲得

### カード構成

- **通常カード**: 4スート（♠♥♦♣）× ランク1-6 × 2デッキ = 96枚
- **切り札**: 最大4枚（ランク7-8）

### ラウンドの流れ

1. **カード配布** - 各プレイヤーに5枚配布
2. **アップグレード公開** - 4枚のアップグレードカードを公開（R3は魔女）
3. **トリックテイキング** - 宣言 → 封印1枚 → 4トリック
4. **アップグレード選択** - トリック獲得順に選択（4位は2金 or 1恩寵を選択）
5. **ワーカープレイスメント** - TRADE/HUNT/RECRUIT/PRAY（+DONATE/RITUAL）実行
6. **給料支払い** - 初期ワーカーのみ給料支払い

### ワーカーアクション

#### 基本アクション

| アクション | 効果 |
|-----------|------|
| TRADE | 交易レベルに応じて金貨獲得（基礎2金） |
| HUNT | 討伐レベルに応じてVP獲得（基礎1VP） |
| RECRUIT | ワーカーを雇用（2金） |
| PRAY | 祈りレベルに応じて恩寵獲得（基礎1恩寵） |

#### アップグレードで解放されるアクション

| アクション | 解放条件 | 効果 |
|-----------|---------|------|
| DONATE | 寄付の祭壇 | 2金消費 → 1恩寵 |
| RITUAL | 儀式の祭壇 | 1ワーカー → 1恩寵 |

### 恩寵システム

恩寵ポイントはゲーム終了時にVPボーナスに変換されます。

#### 恩寵獲得方法

| 方法 | 獲得量 | 条件 |
|------|--------|------|
| 祈りアクション | 1〜3恩寵 | Lv0→1, Lv1→2, Lv2→3 |
| 寄付アクション | 1恩寵 | 2金消費（要アップグレード） |
| 儀式アクション | 1恩寵 | 追加のワーカースロット（要アップグレード） |
| 宣言0成功 | +1恩寵 | 0宣言し、0トリック達成 |
| トリック0勝 | +1恩寵 | 宣言に関係なく0勝時 |
| 4位救済（選択時） | +1恩寵 | 2金の代わりに選択 |
| 《祝福の魔女》 | +1恩寵/ラウンド | 魔女所持時、毎ラウンド終了時 |

#### 恩寵閾値ボーナス（到達した最高閾値のみ適用）

| 恩寵ポイント | VPボーナス |
|-------------|-----------|
| 13点以上 | +8VP |
| 10点以上 | +5VP |

#### 恩寵消費

- **手札交換**: 封印前に1恩寵消費で手札1枚をデッキトップと交換

## ファイル構成

```
coven/
├── main.py           # ゲームロジック・CLI
├── streamlit_app.py  # Streamlit GUI
├── pyproject.toml    # プロジェクト設定
├── game_log.jsonl    # ゲームログ出力先
├── README.md         # このファイル
└── CLAUDE.md         # Claude Code用ガイド
```

### カード入力形式（CLI）

`{スート}{ランク}` 形式:
- S = Spade, H = Heart, D = Diamond, C = Club, T = Trump
- 例: `S06`（スペード6）、`H03`（ハート3）、`T`（切り札）

### ログ出力

ゲームログは `game_log.jsonl` にJSONL形式で保存されます。

## ライセンス

MIT License
